<ion-header class="ion-no-border">
  <ion-toolbar>
    <app-header [title]="headerTitle"></app-header>
    <ion-row>
      <ion-col class="maintenance-header">
        <app-common-filter [title]="headerTitle"
                           [showOverdueList]="showOverdueList"
                           [priorityList]="priorityList"
                           [kitStatusList]="kitStatusList"
                           [workCenterList]="workCenterList"
                           [technicians]="technicians">
        </app-common-filter>
        <app-date-segment (dateRangeEvent)="dateRangeEventHandler($event)"></app-date-segment>
      </ion-col>
    </ion-row>
</ion-toolbar>
</ion-header>


<ion-content [fullscreen]="true">
  <ngx-spinner size="medium" bdColor="#C0C0C0" type="ball-clip-rotate-pulse" [fullScreen]="false"></ngx-spinner>
  <ion-row *ngIf="this.filteredWorkOrderList$ | async as workOrders" class="maintenance-page">
    <ion-col size-lg="3" size-md="3" size-sm="3">
      <ion-list class="unassigned-workorder-list">
        <ion-item>
          <ion-label>
            <span class="kits-count">{{workOrders.unassigned.length}}</span>
            <br>
            <span class="kit-heading">Unassigned Work Orders</span>
          </ion-label>
        </ion-item>
        <div class="column-height">
          <ion-item lines="none" *ngFor="let workOrder of workOrders.unassigned; let i = index;" class="ion-item-cols">
            <ion-label>
              <div class="p-l-15 p-r-15">
              <span *ngIf="workOrder.priorityStatus==='Very High'" class="very-high-priority">VERY HIGH</span>
              <span *ngIf="workOrder.priorityStatus==='High'" class="high-priority">HIGH</span>
              <span *ngIf="workOrder.priorityStatus==='Medium'" class="medium-priority">MEDIUM</span>
              <span *ngIf="workOrder.priorityStatus==='Low'" class="low-priority">LOW</span>

              <span *ngIf="workOrder.kitStatus==='Parts Available'" class="parts-available">PARTS AVAILABLE</span>
              <span *ngIf="workOrder.kitStatus==='Waiting On Parts'" class="waiting-on-parts">WAITING ON PARTS</span>
              <span *ngIf="workOrder.kitStatus==='Kit Ready'" class="kit-ready">KIT READY</span>
              <br/> 
              <span class="kit-number">{{workOrder.workOrderID}} - {{workOrder.workOrderDesc}}</span>
              <span class="display-flex">
                <ion-img [src]="dataIcon" class="list-icons"></ion-img>
                <span class="date-priority-label">{{workOrder.workCenter}} - {{workOrder.equipmentName}}</span>
              </span>
              <span class="display-flex">
                <ion-img [src]="dateIcon" class="list-icons"></ion-img>
                <span class="date-priority-label">{{workOrder.dueDate | date: 'd-MMM-yy'}}</span>
              </span>
              <span class="display-flex">
                <ion-img [src]="timeIcon" class="list-icons"></ion-img>
                <span class="date-priority-label">{{workOrder.estimatedTime}}</span>
              </span>

              <ion-button (click)="onAssignPress(workOrder)" expand="full" class="assign-btn"> 
                <ion-img [src]="assignIcon" class="assign-btn-icon"></ion-img>
                <span class="assign-btn-text">ASSIGN</span> 
              </ion-button>
              </div>

              <ion-button expand="full" fill="clear" (click)="showOperations(workOrder.workOrderID)" class="show-operations-btn" *ngIf="!this.showOperationsList[workOrder.workOrderID]">
                <ion-icon name="chevron-down-outline" class="down-up-arrow"></ion-icon> Show {{workOrder.operations.length}} Operations
              </ion-button>
              <ion-button expand="full" fill="clear" (click)="showOperations(workOrder.workOrderID)" class="show-operations-btn" *ngIf="this.showOperationsList[workOrder.workOrderID]">
                <ion-icon name="chevron-up-outline" class="down-up-arrow"></ion-icon> Hide {{workOrder.operations.length}} Operations
              </ion-button>
              <hr *ngIf="this.showOperationsList[workOrder.workOrderID] === true" class="operations-line"/>
              <span>
                <div *ngIf="this.showOperationsList[workOrder.workOrderID] === true" class="operations-div">
                  <ion-item class="operations-list" *ngFor="let operation of workOrders.unassigned[i].operations; let j = index;">
                    <ion-label>
                      <span class="kit-number">{{operation.operationName}}</span>
                      <span class="display-flex">
                        <ion-img [src]="dataIcon" class="list-icons"></ion-img>
                        <span class="date-priority-label">{{workOrder.workCenter}} - {{workOrder.equipmentName}}</span>
                      </span>
                      <span class="display-flex">
                        <ion-img [src]="dateIcon" class="list-icons"></ion-img>
                        <span class="date-priority-label">{{workOrder.dueDate | date: 'd-MMM-yy'}}</span>
                      </span>
                      <span class="display-flex">
                        <ion-img [src]="timeIcon" class="list-icons"></ion-img>
                        <span class="date-priority-label">{{operation.estimatedTime}}</span>
                      </span>
                    </ion-label>
                  </ion-item>
                </div>
              </span>
            </ion-label>           
          </ion-item>
        </div>
      </ion-list>
    </ion-col>
    <ion-col size-lg="3" size-md="3" size-sm="3">
      <ion-list class="assigned-workorder-list">
        <ion-item>
          <ion-label>
            <span class="kits-count">{{workOrders.assigned.length}}</span>
            <br>
            <span class="kit-heading">Assigned Work Orders</span>
          </ion-label>
        </ion-item>
        <div class="column-height">
            <ion-item lines="none" *ngFor="let workOrder of workOrders.assigned; let i = index;" class="ion-item-cols">
              <ion-label>
                <div class="p-l-15 p-r-15">
                  <span *ngIf="workOrder.priorityStatus==='Very High'" class="very-high-priority">VERY HIGH</span>
                  <span *ngIf="workOrder.priorityStatus==='High'" class="high-priority">HIGH</span>
                  <span *ngIf="workOrder.priorityStatus==='Medium'" class="medium-priority">MEDIUM</span>
                  <span *ngIf="workOrder.priorityStatus==='Low'" class="low-priority">LOW</span>

                  <span *ngIf="workOrder.kitStatus==='Parts Available'" class="parts-available">PARTS AVAILABLE</span>
                  <span *ngIf="workOrder.kitStatus==='Waiting On Parts'" class="waiting-on-parts">WAITING ON PARTS</span>
                  <span *ngIf="workOrder.kitStatus==='Kit Ready'" class="kit-ready">KIT READY</span>
                  <br/>
                  <span class="kit-number">{{workOrder.workOrderID}} - {{workOrder.workOrderDesc}}</span>
                  <span class="display-flex">
                    <ion-img [src]="dataIcon" class="list-icons"></ion-img>
                    <span class="date-priority-label">{{workOrder.workCenter}} - {{workOrder.equipmentName}}</span>
                  </span>
                  <span class="display-flex">
                    <ion-img [src]="dateIcon" class="list-icons"></ion-img>
                    <span class="date-priority-label">{{workOrder.dueDate | date: 'd-MMM-yy'}}</span>
                  </span>
                  <span class="display-flex">
                    <ion-img [src]="timeIcon" class="list-icons"></ion-img>
                    <span class="date-priority-label">{{workOrder.estimatedTime}}</span>
                  </span>
                  <div *ngIf="workOrder.technician && workOrder.technician.length !== 0" class="cursor m-t-10 display-flex" (click)="onAssignPress(workOrder)">
                    <img [hidden]="!getImageSrc(workOrder.technician[0].image)" [attr.src]="getImageSrc(workOrder.technician[0].image)" alt="" class="assign-user-image"/>
                    <span class="assign-user-name m-l-7">{{workOrder.technician[0].personName}}</span>
                  </div>  
                </div>

                <ion-button expand="full" fill="clear" (click)="showOperations(workOrder.workOrderID)" class="show-operations-btn" *ngIf="!this.showOperationsList[workOrder.workOrderID]">
                  <ion-icon name="chevron-down-outline" class="down-up-arrow"></ion-icon> Show {{workOrder.operations.length}} Operations
                </ion-button>
                <ion-button expand="full" fill="clear" (click)="showOperations(workOrder.workOrderID)" class="show-operations-btn" *ngIf="this.showOperationsList[workOrder.workOrderID]">
                  <ion-icon name="chevron-up-outline" class="down-up-arrow"></ion-icon> Hide {{workOrder.operations.length}} Operations
                </ion-button>
                <hr *ngIf="this.showOperationsList[workOrder.workOrderID] === true" class="operations-line"/>
                <span>
                  <div *ngIf="this.showOperationsList[workOrder.workOrderID] === true" class="operations-div">
                    <ion-item class="operations-list" *ngFor="let operation of workOrders.assigned[i].operations; let j = index;">
                      <ion-label>
                        <span class="kit-number">{{operation.operationName}}</span>
                        <span class="display-flex">
                          <ion-img [src]="dataIcon" class="list-icons"></ion-img>
                          <span class="date-priority-label">{{workOrder.workCenter}} - {{workOrder.equipmentName}}</span>
                        </span>
                        <span class="display-flex">
                          <ion-img [src]="dateIcon" class="list-icons"></ion-img>
                          <span class="date-priority-label">{{workOrder.dueDate | date: 'd-MMM-yy'}}</span>
                        </span>
                        <span class="display-flex">
                          <ion-img [src]="timeIcon" class="list-icons"></ion-img>
                          <span class="date-priority-label">{{operation.estimatedTime}}</span>
                        </span>
                      </ion-label>
                    </ion-item>
                  </div>
                </span>
              </ion-label>        
            </ion-item>
        </div>
       </ion-list>
    </ion-col>
    <ion-col size-lg="3" size-md="3" size-sm="3">
      <ion-list class="in-progress-workorder-list">
        <ion-item>
          <ion-label>
            <span class="kits-count">{{workOrders.inProgress.length}}</span>
            <br>
            <span class="kit-heading">In Progress</span>
          </ion-label>
        </ion-item>
        <div class="column-height">
            <ion-item lines="none" *ngFor="let workOrder of workOrders.inProgress; let i = index;" class="ion-item-cols">
              <ion-label>
                <div class="p-l-15 p-r-15">
                  <span *ngIf="workOrder.priorityStatus==='Very High'" class="very-high-priority">VERY HIGH</span>
                  <span *ngIf="workOrder.priorityStatus==='High'" class="high-priority">HIGH</span>
                  <span *ngIf="workOrder.priorityStatus==='Medium'" class="medium-priority">MEDIUM</span>
                  <span *ngIf="workOrder.priorityStatus==='Low'" class="low-priority">LOW</span>
                  <br/>
                  <span class="kit-number">{{workOrder.workOrderID}} - {{workOrder.workOrderDesc}}</span>
                  <span class="display-flex">
                    <ion-img [src]="dataIcon" class="list-icons"></ion-img>
                    <span class="date-priority-label">{{workOrder.workCenter}} - {{workOrder.equipmentName}}</span>
                  </span>
                  <span class="display-flex">
                    <ion-img [src]="dateIcon" class="list-icons"></ion-img>
                    <span class="date-priority-label">{{workOrder.dueDate | date: 'd-MMM-yy'}}</span>
                  </span>
                  <span class="display-flex">
                    <ion-img [src]="timeIcon" class="list-icons"></ion-img>
                    <span class="width-100 display-flex">
                      <span class="date-priority-label">Actual {{workOrder.actualTime}}</span>
                      <span class="date-priority-label float-right">Planned {{workOrder.estimatedTime}}</span>   
                    </span>
                  </span>
                  <ion-progress-bar value="{{workOrder.timeProgress}}" color="medium" class="progress-bar-class"></ion-progress-bar>
                  <span class="display-flex">
                    <ion-img [src]="operationsIcon" class="list-icons"></ion-img>
                    <span class="date-priority-label">{{workOrder.operationProgress[0]}} of {{workOrder.operationProgress[1]}} Operations Completed</span>
                  </span>

                  <ion-progress-bar value="{{workOrder.operationProgress[2]}}" color="medium" class="progress-bar-class"></ion-progress-bar>
                  <div *ngIf="workOrder.technician.length !== 0" class="m-t-10 display-flex">
                    <img [hidden]="!getImageSrc(workOrder.technician[0].image)" [attr.src]="getImageSrc(workOrder.technician[0].image)" alt="" class="assign-user-image"/>
                    <span class="inprogress-user-name m-l-7">{{workOrder.technician[0].personName}}</span>
                  </div>
                </div>
                <ion-button expand="full" fill="clear" (click)="showOperations(workOrder.workOrderID)" class="show-operations-btn" *ngIf="!this.showOperationsList[workOrder.workOrderID]">
                  <ion-icon name="chevron-down-outline" class="down-up-arrow"></ion-icon> Show {{workOrder.operations.length}} Operations
                </ion-button>
                <ion-button expand="full" fill="clear" (click)="showOperations(workOrder.workOrderID)" class="show-operations-btn" *ngIf="this.showOperationsList[workOrder.workOrderID]">
                  <ion-icon name="chevron-up-outline" class="down-up-arrow"></ion-icon> Hide {{workOrder.operations.length}} Operations
                </ion-button>
                <hr *ngIf="this.showOperationsList[workOrder.workOrderID] === true" class="operations-line"/>
                <span>
                  <div *ngIf="this.showOperationsList[workOrder.workOrderID] === true" class="operations-div">
                    <ion-item class="operations-list" *ngFor="let operation of workOrders.inProgress[i].operations; let j = index;">
                      <ion-label>
                        <span class="kit-number">{{operation.operationName}}</span>
                        <span class="display-flex">
                          <ion-img [src]="dataIcon" class="list-icons"></ion-img>
                          <span class="date-priority-label">{{workOrder.workCenter}} - {{workOrder.equipmentName}}</span>
                        </span>
                        <span class="display-flex">
                          <ion-img [src]="dateIcon" class="list-icons"></ion-img>
                          <span class="date-priority-label">{{workOrder.dueDate | date: 'd-MMM-yy'}}</span>
                        </span>
                        <span class="display-flex">
                          <ion-img [src]="timeIcon" class="list-icons"></ion-img>
                          <span class="width-100">
                            <span class="date-priority-label">{{operation.estimatedTime}}</span>
                          </span>
                        </span>
                      </ion-label>
                    </ion-item>
                  </div>
                </span>
              </ion-label>        
            </ion-item>
        </div>
       </ion-list>
    </ion-col>
    <ion-col size-lg="3" size-md="3" size-sm="3">
      <ion-list class="completed-workorder-list">
        <ion-item>
          <ion-label>
            <span class="kits-count">{{workOrders.completed.length}}</span>
            <br>
            <span class="kit-heading">Completed</span>
          </ion-label>
        </ion-item>
        <div class="column-height">
          <ion-item lines="none" *ngFor="let workOrder of workOrders.completed; let i = index;" class="ion-item-cols">
            <ion-label>
              <div class="p-l-15 p-r-15">
                  <span *ngIf="workOrder.priorityStatus==='Very High'" class="very-high-priority">VERY HIGH</span>
                  <span *ngIf="workOrder.priorityStatus==='High'" class="high-priority">HIGH</span>
                  <span *ngIf="workOrder.priorityStatus==='Medium'" class="medium-priority">MEDIUM</span>
                  <span *ngIf="workOrder.priorityStatus==='Low'" class="low-priority">LOW</span>
                  <br/>
                  <span class="kit-number">{{workOrder.workOrderID}} - {{workOrder.workOrderDesc}}</span>
                  <span class="display-flex">
                    <ion-img [src]="dataIcon" class="list-icons"></ion-img>
                    <span class="date-priority-label">{{workOrder.workCenter}} - {{workOrder.equipmentName}}</span>
                  </span>
                  <span class="display-flex">
                    <ion-img [src]="dateIcon" class="list-icons"></ion-img>
                    <span class="date-priority-label">{{workOrder.dueDate | date: 'd-MMM-yy'}}</span>
                  </span>
                  <span class="display-flex">
                    <ion-img [src]="timeIcon" class="list-icons"></ion-img>
                    <span class="date-priority-label">{{workOrder.estimatedTime}}</span>
                  </span>

                  <div *ngIf="workOrder.technician && workOrder.technician.length !== 0" class="m-t-10 display-flex">
                    <img [hidden]="!getImageSrc(workOrder.technician[0].image)" [attr.src]="getImageSrc(workOrder.technician[0].image)" alt="" class="assign-user-image"/>
                    <span class="inprogress-user-name m-l-7">{{workOrder.technician[0].personName}}</span>
                  </div>
              </div>

              <ion-button expand="full" fill="clear" (click)="showOperations(workOrder.workOrderID)" class="show-operations-btn" *ngIf="!this.showOperationsList[workOrder.workOrderID]">
                <ion-icon name="chevron-down-outline" class="down-up-arrow"></ion-icon> Show {{workOrder.operations.length}} Operations
              </ion-button>
              <ion-button expand="full" fill="clear" (click)="showOperations(workOrder.workOrderID)" class="show-operations-btn" *ngIf="this.showOperationsList[workOrder.workOrderID]">
                <ion-icon name="chevron-up-outline" class="down-up-arrow"></ion-icon> Hide {{workOrder.operations.length}} Operations
              </ion-button>
              <hr *ngIf="this.showOperationsList[workOrder.workOrderID] === true" class="operations-line"/>
              <span>
                <div *ngIf="this.showOperationsList[workOrder.workOrderID] === true" class="operations-div">
                  <ion-item class="operations-list" *ngFor="let operation of workOrders.completed[i].operations; let j = index;">
                    <ion-label>
                      <span class="kit-number">{{operation.operationName}}</span>
                      <span class="display-flex">
                        <ion-img [src]="dataIcon" class="list-icons"></ion-img>
                        <span class="date-priority-label">{{workOrder.workCenter}} - {{workOrder.equipmentName}}</span>
                      </span>
                      <span class="display-flex">
                        <ion-img [src]="dateIcon" class="list-icons"></ion-img>
                        <span class="date-priority-label">{{workOrder.dueDate | date: 'd-MMM-yy'}}</span>
                      </span>
                      <span class="display-flex">
                        <ion-img [src]="timeIcon" class="list-icons"></ion-img>
                        <span class="date-priority-label">{{opearation.estimatedTime}}</span>
                      </span>
                    </ion-label>
                  </ion-item>
                </div>
              </span>
            </ion-label>        
          </ion-item>
        </div>
       </ion-list>
      </ion-col>
  </ion-row> 
</ion-content>
