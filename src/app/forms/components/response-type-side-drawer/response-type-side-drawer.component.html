<div
  class="app-customizer"
  *ngIf="sliderOpenState.isOpen && sliderOpenState.questionId === question.id"
>
  <mat-card
    class="p-0"
    *ngIf="sliderOpenState.isOpen && question.id === sliderOpenState.questionId"
  >
    <mat-card-title class="m-0 light-gray">
      <div class="top-bar">
        <svg-icon
          id="sliderResponseCancelBtn"
          icon="icon-close"
          class="cancel"
          (click)="cancelSlider()"
        ></svg-icon>
        <h1
          id="responseTypeSliderText"
          class="mcq-heading"
          translate="slider"
        ></h1>
      </div>
    </mat-card-title>
    <mat-card-content class="matCardContent">
      <div [formGroup]="sliderOptionsForm">
        <div class="dis-flex">
          <div class="slider-input-container m-r-15">
            <label
              id="responseTypeSliderForm"
              for="min"
              translate="from"
              class="values"
            ></label
            ><br />
            <input
              id="min"
              max="{{ sliderOptionsForm.get('max').value - 1 }}"
              type="number"
              class="slider-inputs"
              formControlName="min"
            />
          </div>
          <div class="slider-input-container m-r-5">
            <label
              id="responseTypeSliderTo"
              for="max"
              translate="to"
              class="values"
            ></label
            ><br />
            <input
              id="max"
              min="{{ sliderOptionsForm.value.min + 1 }}"
              type="number"
              class="slider-inputs"
              formControlName="max"
            />
          </div>
        </div>
        <label>Value</label>
        <mat-slider
          [min]="sliderOptionsForm.get('min').value"
          [max]="sliderOptionsForm.get('max').value"
          [step]="sliderOptionsForm.get('increment').value"
          color="primary"
          formControlName="value"
          class="width-100"
          showTickMarks
          thumbLabel
          discrete
        >
          <input matSliderThumb />
        </mat-slider>
        <div class="margin-20">
          <label
            id="responseTypeSliderIncrement"
            for="incre"
            translate="increment"
            class="values"
          ></label>
          <br />
          <input
            min="0"
            max="{{
              sliderOptionsForm.get('max').value -
                sliderOptionsForm.get('min').value
            }}"
            id="incre"
            type="number"
            class="slider-inputs"
            formControlName="increment"
          />
        </div>
      </div>
    </mat-card-content>
  </mat-card>
  <div class="sliderFooter">
    <button
      id="responseTypeSliderCancelBtn"
      mat-stroked-button
      color="primary"
      class="cancel-slider"
      (click)="cancelSlider()"
      translate="cancel"
    ></button>
    <button
      id="responseTypeSliderApplyBtn"
      mat-raised-button
      color="primary"
      class="apply-slider-btn"
      (click)="applySliderOptions()"
      translate="apply"
    ></button>
  </div>
</div>

<div class="app-customizer" *ngIf="multipleChoiceOpenState">
  <mat-card class="p-0" *ngIf="multipleChoiceOpenState === true">
    <mat-card-title class="m-0 light-gray">
      <div class="top-bar">
        <svg-icon
          id="sliderResponseCancelBtn"
          icon="icon-close"
          class="cancel"
          (click)="cancelResponse()"
        ></svg-icon>
        <h1
          id="responseTypeSliderMCQ"
          class="mcq-heading"
          translate="multipleChoice"
        ></h1>
      </div>
    </mat-card-title>
    <div [formGroup]="responseForm">
      <div
        id="responseTypeSliderMCQText"
        class="margin response-heading"
        translate="response"
      ></div>
      <input type="hidden" formControlName="id" />

      <mat-card-content>
        <div
          class="width-100 response-drop-list"
          formArrayName="responses"
          cdkScrollable
        >
          <div cdkDrop cdkDropList [cdkDropListData]="getResponseList()">
            <div *ngFor="let response of getResponseList(); let i = index">
              <div [formGroupName]="i" class="dis-flex response-list">
                <input
                  id="responseTypeSliderTitle"
                  matInput
                  formControlName="title"
                  [placeholder]="'responseTitle' | translate"
                  autocomplete="off"
                  class="input-forms"
                  (keyup.enter)="initResponse(); keytab($event)"
                />
                <div>
                  <input
                    id="responseTypeSliderColor"
                    matInput
                    class="input-forms"
                    type="color"
                    (change)="applyBGColor($event, response)"
                    class="color-type"
                    formControlName="color"
                    [hidden]="respType === 'globalResponse'"
                  />
                  <button
                    id="responseTypeSliderDelete"
                    mat-flat-button
                    (click)="deleteResponse(i)"
                    color="#545F70"
                    class="delete-btn"
                  >
                    <svg-icon
                      id="responseTypeSliderDeleteIcon"
                      icon="icon-delete-icon"
                      class="delete-btn-icon"
                    ></svg-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <button
            id="responseTypeSliderAddResponseBtn"
            mat-flat-button
            (click)="initResponse()"
            class="add-response"
            translate="addRes"
          ></button>
        </div>
      </mat-card-content>
    </div>
  </mat-card>

  <div class="actions-footer">
    <button
      id="responseTypeSliderCancelResBtn"
      mat-stroked-button
      class="cancel-response-btn"
      (click)="cancelResponse()"
      translate="cancel"
    ></button>
    <button
      id="responseTypeSliderSubmitBtn"
      mat-raised-button
      (click)="submitResponses()"
      class="submit-response-btn"
      [disabled]="isFormNotUpdated === true || responseForm.pristine"
    >
      {{ (isCreate ? 'create' : 'update') | translate }}
    </button>
  </div>
</div>

<div
  class="app-customizer"
  *ngIf="
    rangeSelectorOpenState.isOpen &&
    rangeSelectorOpenState.questionId === question.id
  "
>
  <mat-card
    class="p-0"
    *ngIf="
      rangeSelectorOpenState.isOpen === true &&
      rangeSelectorOpenState.questionId === question.id
    "
  >
    <mat-card-title class="m-0 light-gray">
      <div class="top-bar">
        <svg-icon
          id="sliderResponseCancelBtn"
          icon="icon-close"
          class="cancel"
          (click)="cancelRangeSelection()"
        ></svg-icon>
        <h1
          id="responseTypeSliderRangeText"
          class="mcq-heading"
          translate="rangeSelectorHeading"
        ></h1>
      </div>
    </mat-card-title>
    <mat-card-content class="matCardContent">
      <div class="rangeLimitContainer" [formGroup]="rangeMetadataForm">
        <div class="limit">
          <div class="limitContent">
            <div class="limitValue">
              <span
                id="responseTypeSliderRangeLowerLimit"
                translate="lowerLimitTxt"
              ></span>
              <input
                id="responseTypeSliderLimitText"
                matInput
                type="number"
                autocomplete="off"
                class="inputField"
                formControlName="min"
              />
            </div>
            <div class="limitAction">
              <label
                id="responseTypeSliderLowerCondText"
                translate="lowerLimitConditionTxt"
              ></label>
              <mat-radio-group
                class="limitRadioGroup"
                formControlName="minAction"
                [disabled]="!rangeMetadataForm.get('min').value"
              >
                <mat-radio-button
                  *ngFor="let action of lowerLimitActions"
                  class="limitRadioOption"
                  [value]="action"
                >
                  {{ action }}
                </mat-radio-button>
              </mat-radio-group>
            </div>
          </div>
          <div
            class="limitMessage"
            [ngClass]="{
              warning: rangeMetadataForm.get('minAction').value === 'Warning',
              alert: rangeMetadataForm.get('minAction').value === 'Alert',
              note: rangeMetadataForm.get('minAction').value === 'Note'
            }"
            *ngIf="
              rangeMetadataForm.get('minAction').value &&
              rangeMetadataForm.get('minAction').value.length &&
              rangeMetadataForm.get('minAction').value !== 'None'
            "
          >
            <div class="messageHead">
              <span class="titleRow">
                <svg-icon
                  id="responseTypeSliderTitleRowIcon"
                  class="titleRowIcon"
                  [icon]="getImage(rangeMetadataForm.get('minAction').value)"
                >
                </svg-icon>
                <span id="responseTypeSliderMinAction" class="title">
                  {{ rangeMetadataForm.get('minAction').value }}
                </span>
              </span>
              <mat-icon
                id="responseTypeSliderEditIcon"
                class="editIcon"
                (click)="focusMinMsg()"
                >edit</mat-icon
              >
            </div>
            <div class="messageInput">
              <textarea
                rows="2"
                matInput
                wrap="soft"
                maxlength="70"
                placeholder="{{ 'enterMessage' | translate }}"
                id="minMsgInput"
                autocomplete="off"
                class="inputField"
                formControlName="minMsg"
              ></textarea>
            </div>
          </div>
        </div>
        <mat-divider class="limitDivider"></mat-divider>
        <div class="limit">
          <div class="limitContent">
            <div class="limitValue">
              <span
                id="responseTypeSliderUpperLimit"
                translate="upperLimitTxt"
              ></span>
              <input
                id="responseTypeSliderUpperLimitText"
                matInput
                type="number"
                autocomplete="off"
                class="inputField"
                formControlName="max"
              />
            </div>
            <div class="limitAction">
              <label
                id="responseTypeSliderUpperLimCond"
                translate="upperLimitConditionTxt"
              ></label>
              <mat-radio-group
                class="limitRadioGroup"
                formControlName="maxAction"
                [disabled]="!rangeMetadataForm.get('max').value"
              >
                <mat-radio-button
                  *ngFor="let action of upperLimitActions"
                  class="limitRadioOption"
                  [value]="action"
                >
                  {{ action }}
                </mat-radio-button>
              </mat-radio-group>
            </div>
          </div>
          <div
            class="limitMessage"
            [ngClass]="{
              warning: rangeMetadataForm.get('maxAction').value === 'Warning',
              alert: rangeMetadataForm.get('maxAction').value === 'Alert',
              note: rangeMetadataForm.get('maxAction').value === 'Note'
            }"
            *ngIf="
              rangeMetadataForm.get('maxAction').value &&
              rangeMetadataForm.get('maxAction').value.length &&
              rangeMetadataForm.get('maxAction').value !== 'None'
            "
          >
            <div class="messageHead">
              <span class="titleRow">
                <svg-icon
                  id="responseTypeSliderTitleRow"
                  class="titleRowIcon"
                  [icon]="getImage(rangeMetadataForm.get('maxAction').value)"
                >
                </svg-icon>
                <span id="responseTypeSliderMaxAction" class="title">{{
                  rangeMetadataForm.get('maxAction').value
                }}</span>
              </span>
              <mat-icon
                id="responseTypeSliderMaxEdit"
                class="editIcon"
                (click)="focusMaxMsg()"
                >edit</mat-icon
              >
            </div>
            <div class="messageInput">
              <textarea
                rows="2"
                wrap="soft"
                matInput
                maxlength="70"
                placeholder="{{ 'enterMessage' | translate }}"
                id="maxMsgInput"
                autocomplete="off"
                class="inputField"
                formControlName="maxMsg"
              ></textarea>
            </div>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
  <div class="rangeSelectorFooter">
    <button
      id="responseTypeSliderCancelRangeBtn"
      mat-stroked-button
      class="cancelBtn"
      (click)="cancelRangeSelection()"
      translate="cancel"
    ></button>
    <button
      id="responseTypeSliderSubmitRangeBtn"
      mat-raised-button
      (click)="submitRangeSelection()"
      color="primary"
      class="applyBtn"
      translate="apply"
    ></button>
  </div>
</div>

<div
  class="app-customizer additional-details-slider"
  *ngIf="
    additionalDetailsOpenState.isOpen &&
    additionalDetailsOpenState.questionId === question.id
  "
>
  <mat-card
    class="p-0"
    *ngIf="
      additionalDetailsOpenState.isOpen &&
      additionalDetailsOpenState.questionId === question.id
    "
  >
    <mat-card-title class="m-0 light-gray">
      <div class="top-bar">
        <svg-icon
          id="sliderResponseCancelBtn"
          icon="icon-close"
          class="cancel"
          (click)="cancelAdditionalDetails()"
        ></svg-icon>
        <h1
          id="additionalDetailsText"
          class="additional-details-heading"
          translate="additionalDetailsHeading"
        ></h1>
      </div>
    </mat-card-title>
    <mat-card-content class="matCardContent">
      <div [formGroup]="additionalDetailsForm">
        <div class="tags">
          <p id="tagsHeading" class="tags-heading m-b-0">
            {{ 'tags' | translate }}
          </p>
          <mat-form-field class="chips-list width-100" appearance="outline">
            <mat-chip-list #chipList>
              <mat-chip
                *ngFor="let tag of tags"
                [selectable]="selectable"
                [removable]="removable"
                (removed)="remove(tag)"
                class="tags-mat-chips"
              >
                {{ tag }}
                <mat-icon matChipRemove *ngIf="removable" id="cancelTag"
                  >cancel</mat-icon
                >
              </mat-chip>
              <input
                id="AddTag"
                [placeholder]="'startTypingTags' | translate"
                [matChipInputFor]="chipList"
                [matAutocomplete]="auto"
                [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                (matChipInputTokenEnd)="add($event)"
                (click)="openAutoComplete()"
                #tagsInput
                [formControl]="tagsCtrl"
              />
            </mat-chip-list>

            <mat-autocomplete
              #auto="matAutocomplete"
              (optionSelected)="selected($event)"
            >
              <mat-option
                *ngFor="let tag of filteredTags | async"
                [value]="tag"
                id="tagOptions"
              >
                {{ tag }}
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>
          <mat-error
            id="tagsError"
            *ngIf="processValidationErrorTags()"
            class="m-5"
          >
            {{
              errors.tagsCtrl.name
                | translate
                  : {
                      name: 'tags' | translate,
                      length: errors.tagsCtrl.length
                    }
            }}
          </mat-error>
        </div>
        <div class="additional-details m-t-16">
          <p
            translate="attributesHeading"
            id="attributesHeading"
            class="tags-heading"
          ></p>
          <div
            class="label-value-text"
            *ngIf="
              additionalDetailsForm.get('attributes')['controls']?.length > 0
            "
          >
            <div class="width-45 label" id="labelHeading">
              {{ 'label' | translate }}
            </div>
            <div class="width-45 m-l-10 value" id="valueHeading">
              {{ 'value' | translate }}
            </div>
          </div>
          <div formArrayName="attributes">
            <div
              *ngFor="
                let additionalDetails of getAttributeList();
                let i = index
              "
            >
              <div [formGroupName]="i" class="dis-flex">
                <div class="width-43">
                  <mat-form-field
                    appearance="outline"
                    class="m-l-5 symbol m-b-10 width-100"
                  >
                    <input
                      id="labelValueText"
                      #labelInput
                      matInput
                      type="text"
                      formControlName="label"
                      [matAutocomplete]="autolabel"
                      (click)="labelOptionClick(i)"
                    />
                    <mat-autocomplete #autolabel="matAutocomplete">
                      <mat-option
                        id="labelOption"
                        *ngFor="let label of filteredLabels$ | async"
                        [value]="label"
                      >
                        {{ label }}
                        <button
                          id="removeBtn"
                          mat-button
                          class="remove-btn"
                          (click)="removeLabel(label, i)"
                        >
                          <span>{{ 'removeBtn' | translate }}</span>
                        </button>
                      </mat-option>
                      <mat-option
                        *ngIf="
                          additionalDetailsForm.get('attributes')['controls'][i]
                            .value.label
                        "
                      >
                        <ng-container>
                          <button
                            id="labelBtn"
                            mat-button
                            color="primary"
                            class="p-0 add-new-button"
                            (click)="storeDetails(i)"
                            [disabled]="
                              additionalDetailsForm.get('attributes')[
                                'controls'
                              ][i].invalid ||
                              additionalDetailsForm.get('attributes')[
                                'controls'
                              ][i].pristine
                            "
                          >
                            <mat-icon class="m-r-5" id="addLabelIcon"
                              >add</mat-icon
                            >

                            <span id="LabelText"
                              >{{ 'addNew' | translate }} ({{
                                additionalDetailsForm.get('attributes')[
                                  'controls'
                                ][i].value.label
                              }})</span
                            >
                          </button>
                        </ng-container>
                      </mat-option>
                    </mat-autocomplete>

                    <mat-error
                      id="labelError"
                      *ngIf="processValidationErrorsAttributes(i, 'label')"
                      class="m-t-5 error-fields"
                    >
                      {{
                        errors?.label?.name
                          | translate
                            : {
                                name: 'label' | translate,
                                length: errors?.label?.length
                              }
                      }}
                    </mat-error>
                  </mat-form-field>
                </div>

                <div class="width-43">
                  <mat-form-field
                    appearance="outline"
                    class="m-l-20 symbol m-b-10 width-100 value-field"
                  >
                    <input
                      id="valueText"
                      #valueInput
                      matInput
                      type="text"
                      formControlName="value"
                      [matAutocomplete]="autoValue"
                      class="example-input"
                      (click)="valueOptionClick(i)"
                    />
                    <mat-autocomplete #autoValue="matAutocomplete">
                      <mat-option
                        id="valueOptions"
                        *ngFor="let value of filteredValues$ | async"
                        [value]="value"
                      >
                        {{ value }}
                        <button
                          id="removeValueBtn"
                          mat-button
                          class="remove-btn"
                          (click)="removeValue(value, i)"
                        >
                          <span>{{ 'removeBtn' | translate }}</span>
                        </button>
                      </mat-option>

                      <mat-option
                        *ngIf="
                          additionalDetailsForm.get('attributes')['controls'][
                            i
                          ]['value'].value
                        "
                      >
                        <button
                          id="addValueBtn"
                          mat-button
                          color="primary"
                          class="p-0 add-new-button"
                          (click)="storeValueDetails(i)"
                          [disabled]="
                            additionalDetailsForm.get('attributes')['controls'][
                              i
                            ].invalid ||
                            additionalDetailsForm.get('attributes')['controls'][
                              i
                            ].pristine
                          "
                        >
                          <mat-icon id="addValueIcon" class="m-r-5"
                            >add</mat-icon
                          >

                          <span id="addValue"
                            >{{ 'addNew' | translate }} ({{
                              additionalDetailsForm.get('attributes')[
                                'controls'
                              ][i]['value'].value
                            }})</span
                          >
                        </button>
                      </mat-option>
                    </mat-autocomplete>

                    <mat-error
                      id="valueError"
                      *ngIf="processValidationErrorsAttributes(i, 'value')"
                      class="m-t-5 error-fields"
                    >
                      {{
                        errors?.value?.name
                          | translate
                            : {
                                name: 'value' | translate,
                                length: errors?.value?.length
                              }
                      }}
                    </mat-error>
                  </mat-form-field>
                </div>
                <div class="width-14 cancel-icon">
                  <svg-icon
                    id="closeIcon"
                    icon="icon-closeIcon"
                    class="close-icon cursor-pointer"
                    (click)="deleteAttributes(i)"
                  ></svg-icon>
                </div>
              </div>
            </div>
          </div>
          <button
            [disabled]="
              additionalDetailsForm.get('attributes')['controls'].length >= 5
            "
            class="add-button"
            (click)="addAttributes()"
            id="attributesBtn"
          >
            <span
              *ngIf="
                additionalDetailsForm.get('attributes')['controls'].length < 5
              "
            >
              <svg-icon
                id="addMoreIcon"
                icon="icon-add-more"
                class="add-more-icon"
              ></svg-icon
            ></span>
            <span
              *ngIf="
                additionalDetailsForm.get('attributes')['controls'].length >= 5
              "
            >
              <svg-icon
                id="addMoreIcon"
                icon="icon-add-more-gray"
                class="add-more-icon"
              ></svg-icon
            ></span>
            <span>{{ 'addMoreUpto5' | translate }}</span>
          </button>
        </div>
        <div
          *ngIf="
            this.question.fieldType === 'TF' || this.question.fieldType === 'NF'
          "
        >
          <div class="dis-flex justify-content-space-between m-t-16 m-b-16">
            <p class="tags-heading" translate>characterLimit</p>
            <mat-slide-toggle
              id="characterToggle"
              [(ngModel)]="enabledCharLimit"
              class="collapse-btn slide-toggle"
              [ngModelOptions]="{ standalone: true }"
            ></mat-slide-toggle>
          </div>

          <div [formGroup]="minMaxCharForm" class="dis-flex">
            <div class="width-49">
              <label
                for="minCharValue"
                id="minCharacter"
                class="tags-heading"
                translate
              >
                minCharacterLimit
              </label>
              <mat-form-field appearance="outline" class="width-100">
                <input
                  formControlName="minCharValue"
                  [disabled]="!enabledCharLimit"
                  type="number"
                  min="0"
                  [max]="minMaxCharForm.get('maxCharValue').value - 1"
                  matInput
              /></mat-form-field>
              <mat-error
                *ngIf="
                  minMaxCharForm.get('minCharValue').hasError('minMaxInvalid')
                "
              >
                Min Character Limit cannot be greater than Max Character Limit.
              </mat-error>
            </div>
            <div class="width-49 m-l-10">
              <label
                for="maxCharValue"
                id="maxCharacter"
                class="tags-heading"
                translate
              >
                maxCharacterLimit
              </label>
              <mat-form-field appearance="outline" class="width-100">
                <input
                  formControlName="maxCharValue"
                  [disabled]="!enabledCharLimit"
                  type="number"
                  [min]="minMaxCharForm.get('minCharValue').value + 1"
                  matInput
              /></mat-form-field>
              <mat-error
                *ngIf="
                  minMaxCharForm.get('maxCharValue').hasError('minMaxInvalid')
                "
              >
                Max Character Limit cannot be less than Min Character Limit.
              </mat-error>
              <mat-error *ngIf="minMaxCharForm.hasError('minMaxEqual')">
                Max Character Limit cannot be equal to Min Character Limit.
              </mat-error>
            </div>
          </div>
        </div>
      </div></mat-card-content
    ></mat-card
  >
  <div class="additionalDetailsFooter">
    <button
      id="additionalDetailsCancelBtn"
      mat-stroked-button
      class="cancelBtn"
      (click)="cancelAdditionalDetails()"
      translate="cancel"
    ></button>
    <button
      id="additionalDetailsSubmitBtn"
      mat-raised-button
      (click)="submitAdditionalDetails()"
      [disabled]="
        additionalDetailsForm.invalid ||
        tagsCtrl.invalid ||
        minMaxCharForm.invalid
      "
      class="submitBtn"
      translate="done"
    ></button>
  </div>
</div>
