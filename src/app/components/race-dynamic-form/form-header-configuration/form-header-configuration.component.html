<div mat-dialog-actions align="end" class="buttons">
  <button
    id="cancelBtn"
    mat-stroked-button
    type="button"
    color="primary"
    class="skip-btn"
    (click)="onCancel()"
    translate="cancelBtn"
  ></button>
  <button
    id="nextBtn"
    mat-raised-button
    type="submit"
    color="primary"
    class="next-btn"
    (click)="next()"
    [disabled]="headerDataForm.invalid"
    translate="nextBtn"
  ></button>
</div>
<div *ngIf="!this.isCreateAI">
  <div class="form-header-modal" [formGroup]="headerDataForm">
    <div class="dis-flex form-content">
      <div class="width-5"></div>
      <div class="width-95">
        <div class="form-detials">
          <h2 class="heading" id="formDetails">
            {{ 'setFormDetailsHeading' | translate }}
          </h2>

          <p
            class="sub-heading"
            id="formSubHeading"
            translate="setFormTypeHeading"
          ></p>
          <div class="formtype-flex">
            <mat-radio-group class="dis-flex" formControlName="formType">
              <div class="formtype-style">
                <mat-radio-button
                  id="standaloneRadioBtn"
                  class="radio-btns"
                  [value]="formConfigurationStatus.standalone"
                  [disabled]="this.formData.formExists"
                ></mat-radio-button>
                <span
                  class="radio-btn-text"
                  id="standaloneText"
                  translate="standalone"
                >
                </span>
                <p
                  class="radio-sub-text"
                  id="standaloneSubText"
                  translate="standaloneSubText"
                ></p>
              </div>
              <div class="formtype-style">
                <mat-radio-button
                  id="embeddedRadioBtn"
                  class="radio-btns"
                  [value]="formConfigurationStatus.embedded"
                  [disabled]="this.formData.formExists"
                ></mat-radio-button>
                <span
                  id="embeddedText"
                  class="radio-btn-text"
                  translate="embedded"
                >
                </span
                ><br />
                <p
                  id="standaloneSubText"
                  class="radio-sub-text"
                  translate="embeddedSubText"
                ></p>
              </div>
            </mat-radio-group>
          </div>
          <hr class="horizontal-line" />

          <div class="form-name">
            <p class="form-name-description" id="formNameHeading">
              {{ 'addFormNameMandatory' | translate }}
            </p>
            <mat-form-field appearance="outline" class="width-100">
              <input
                id="formName"
                type="text"
                name="formName"
                matInput
                [placeholder]="'formName' | translate"
                formControlName="name"
              />
              <mat-error
                *ngIf="processValidationErrors('name')"
                class="m-5 error-fields"
                id="formNameError"
              >
                {{
                  errors.name.name
                    | translate
                      : { name: 'name' | translate, length: errors.name.length }
                }}
              </mat-error>
            </mat-form-field>
            <p
              id="formDescriptionHeading"
              class="form-name-description"
              translate="addFormDescription"
            ></p>
            <mat-form-field appearance="outline" class="width-100">
              <input
                id="formDescription"
                type="text"
                matInput
                name="formDescription"
                [placeholder]="'addDescription' | translate"
                formControlName="description"
              />
            </mat-form-field>
            <p class="form-name-description" id="plantHeading">
              {{ 'plantMandatory' | translate }}
            </p>
            <mat-form-field appearance="outline" class="width-100">
              <mat-select
                formControlName="plantId"
                [placeholder]="'plant' | translate"
                (openedChange)="resetPlantSearchFilter()"
                [disabled]="this.formData.formExists"
              >
                <input
                  id="plantName"
                  class="searchable-input"
                  [placeholder]="'search' | translate"
                  (keyup)="onKeyPlant($event)"
                  [value]="plantFilterInput"
                />
                <div class="scrollable-area">
                  <mat-option
                    id="plantOptions"
                    [value]="plant.id"
                    *ngFor="let plant of plantInformation"
                    >{{ plant.plantId }} - {{ plant.name }}</mat-option
                  >
                </div>
              </mat-select>
              <mat-error
                id="plantError"
                *ngIf="processValidationErrors('plantId')"
                class="m-t-5 error-fields"
              >
                {{
                  errors.plantId.name
                    | translate
                      : {
                          name: 'plant' | translate
                        }
                }}
              </mat-error>
            </mat-form-field>
          </div>
          <div class="tags">
            <p id="tagsHeading" class="form-name-description m-b-0">
              {{ 'tags' | translate }}
            </p>
            <mat-form-field class="chips-list width-100" appearance="outline">
              <mat-chip-list #chipList>
                <mat-chip
                  *ngFor="let tag of tags"
                  [selectable]="selectable"
                  [removable]="removable"
                  (removed)="remove(tag)"
                  class="tags-mat-chips"
                >
                  {{ tag }}
                  <mat-icon matChipRemove *ngIf="removable" id="cancelTag"
                    >cancel</mat-icon
                  >
                </mat-chip>
                <input
                  id="AddTag"
                  [placeholder]="'startTypingTags' | translate"
                  [matChipInputFor]="chipList"
                  [matAutocomplete]="auto"
                  [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                  (matChipInputTokenEnd)="add($event)"
                  (click)="openAutoComplete()"
                  #tagsInput
                  [formControl]="tagsCtrl"
                />
              </mat-chip-list>

              <mat-autocomplete
                #auto="matAutocomplete"
                (optionSelected)="selected($event)"
              >
                <mat-option
                  *ngFor="let tag of filteredTags | async"
                  [value]="tag"
                  id="tagOptions"
                >
                  {{ tag }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div>

          <div class="notes-attachment" formGroupName="instructions">
            <p
              id="notesAndAttachementsHeading"
              class="form-name-description m-b-0 m-t-20"
              translate="notesAndAttachment"
            ></p>
            <mat-form-field
              class="notes-attachment width-100"
              appearance="outline"
            >
              <quill-material
                #notes
                [ngClass]="{
                  'display-toolbar': isOpen.value
                }"
                formControlName="notes"
                [placeholder]="'addNotes' | translate"
                class="notes-field"
                (editorFocus)="handleEditorFocus($event)"
              >
              </quill-material>

              <mat-error
                id="notesAndAttachementsError"
                *ngIf="maxLengthWithoutBulletPoints(250)"
                class="m-5 error-fields"
              >
                {{ 'errorExceedingLimit' | translate }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="add-attachments">
            <br />
            <input
              id="addAttachments"
              type="file"
              class="file-upload"
              accept="image/jpeg,image/jpg,image/png,application/pdf"
              (change)="formFileUploadHandler($event)"
              [hidden]="true"
              #formFileUpload
            />

            <button
              id="attachmentsBtn"
              mat-button
              color="primary"
              class="upload-button"
              (click)="formFileUpload.click()"
            >
              <mat-icon class="icon-upload" id="attachmentsIcon">link</mat-icon>
              <span
                id="attachmentsText"
                translate="addImagesAndPDFBtnNew"
              ></span>
            </button>

            <div class="attachments-container">
              <span
                id="attachmentsTrack"
                *ngFor="
                  let image of filteredMediaType.mediaType;
                  index as i;
                  trackBy: trackBySelectedattachments
                "
                class="m-r-10"
              >
                <app-upload-image-preview
                  [image]="image"
                  (imageIndexEmitter)="formFileDeleteHandler(i)"
                  class="attachments cursor-pointer"
                  (triggerPreviewDialog)="openPreviewDialog()"
                ></app-upload-image-preview>
              </span>

              <span
                *ngFor="
                  let pdf of pdfFiles.mediaType;
                  index as i;
                  trackBy: trackBySelectedattachments
                "
                class="m-r-10"
              >
                <app-instruction-pdf
                  [pdf]="pdf"
                  (indexEmitter)="formPdfDeleteHandler(i)"
                ></app-instruction-pdf>
              </span>
            </div>
          </div>

          <div class="additional-details">
            <p
              translate="additionalDetails"
              id="additionalDetailsHeading"
              class="additional-details-text"
            ></p>
            <button
              *ngIf="
                headerDataForm.get('additionalDetails')['controls'].length < 5
              "
              class="add-button"
              (click)="addAdditionalDetails()"
              id="additionalDetailsBtn"
            >
              {{ 'add' | translate }}
            </button>
          </div>
          <div
            class="label-value-text"
            *ngIf="
              headerDataForm.get('additionalDetails')['controls']?.length > 0
            "
          >
            <div class="width-45 label" id="labelHeading">
              {{ 'label' | translate }}
            </div>
            <div class="width-45 m-l-20 value" id="valueHeading">
              {{ 'value' | translate }}
            </div>
          </div>
          <div formArrayName="additionalDetails">
            <div
              *ngFor="
                let additionalDetails of getAdditionalDetailList();
                let i = index
              "
            >
              <div [formGroupName]="i" class="dis-flex">
                <div class="width-45">
                  <mat-form-field
                    appearance="outline"
                    class="m-l-5 symbol m-b-10 width-100"
                  >
                    <input
                      id="labelValueText"
                      #labelInput
                      matInput
                      type="text"
                      formControlName="label"
                      class="example-input"
                      [matAutocomplete]="autolabel"
                      (click)="labelOptionClick(i)"
                    />
                    <mat-autocomplete #autolabel="matAutocomplete">
                      <mat-option
                        id="labelOption"
                        *ngFor="let label of filteredLabels$ | async"
                        [value]="label"
                      >
                        {{ label }}
                        <button
                          id="removeBtn"
                          mat-button
                          class="remove-btn"
                          (click)="removeLabel(label, i)"
                        >
                          <span>{{ 'removeBtn' | translate }}</span>
                        </button>
                      </mat-option>
                      <mat-option
                        *ngIf="
                          headerDataForm.get('additionalDetails')['controls'][i]
                            .value.label
                        "
                      >
                        <ng-container>
                          <button
                            id="labelBtn"
                            mat-button
                            color="primary"
                            class="p-0 add-new-button"
                            (click)="storeDetails(i)"
                            [disabled]="
                              headerDataForm.get('additionalDetails')[
                                'controls'
                              ][i].invalid ||
                              headerDataForm.get('additionalDetails')[
                                'controls'
                              ][i].pristine
                            "
                          >
                            <mat-icon class="m-r-5" id="addLabelIcon"
                              >add</mat-icon
                            >

                            <span id="LabelText"
                              >{{ 'addNew' | translate }} ({{
                                headerDataForm.get('additionalDetails')[
                                  'controls'
                                ][i].value.label
                              }})</span
                            >
                          </button>
                        </ng-container>
                      </mat-option>
                    </mat-autocomplete>

                    <mat-error
                      id="labelError"
                      *ngIf="
                        processValidationErrorsAdditionalDetails(i, 'label')
                      "
                      class="m-t-5 error-fields"
                    >
                      {{
                        errors?.label?.name
                          | translate
                            : {
                                name: 'label' | translate,
                                length: errors?.label?.length
                              }
                      }}
                    </mat-error>
                  </mat-form-field>
                </div>

                <div class="width-45">
                  <mat-form-field
                    appearance="outline"
                    class="m-l-20 symbol m-b-10 width-100 value-field"
                  >
                    <input
                      id="valueText"
                      #valueInput
                      matInput
                      type="text"
                      formControlName="value"
                      [matAutocomplete]="autoValue"
                      class="example-input"
                      (click)="valueOptionClick(i)"
                    />
                    <mat-autocomplete #autoValue="matAutocomplete">
                      <mat-option
                        id="valueOptions"
                        *ngFor="let value of filteredValues$ | async"
                        [value]="value"
                      >
                        {{ value }}
                        <button
                          id="removeValueBtn"
                          mat-button
                          class="remove-btn"
                          (click)="removeValue(value, i)"
                        >
                          <span>{{ 'removeBtn' | translate }}</span>
                        </button>
                      </mat-option>

                      <mat-option
                        *ngIf="
                          headerDataForm.get('additionalDetails')['controls'][
                            i
                          ]['value'].value
                        "
                      >
                        <button
                          id="addValueBtn"
                          mat-button
                          color="primary"
                          class="p-0 add-new-button"
                          (click)="storeValueDetails(i)"
                          [disabled]="
                            headerDataForm.get('additionalDetails')['controls'][
                              i
                            ].invalid ||
                            headerDataForm.get('additionalDetails')['controls'][
                              i
                            ].pristine
                          "
                        >
                          <mat-icon id="addValueIcon" class="m-r-5"
                            >add</mat-icon
                          >

                          <span id="addValue"
                            >{{ 'addNew' | translate }} ({{
                              headerDataForm.get('additionalDetails')[
                                'controls'
                              ][i]['value'].value
                            }})</span
                          >
                        </button>
                      </mat-option>
                    </mat-autocomplete>

                    <mat-error
                      id="valueError"
                      *ngIf="
                        processValidationErrorsAdditionalDetails(i, 'value')
                      "
                      class="m-t-5 error-fields"
                    >
                      {{
                        errors?.value?.name
                          | translate
                            : {
                                name: 'value' | translate,
                                length: errors?.value?.length
                              }
                      }}
                    </mat-error>
                  </mat-form-field>
                </div>
                <div class="width-10 cancel-icon">
                  <svg-icon
                    id="closeIcon"
                    icon="icon-closeIcon"
                    class="close-icon cursor-pointer"
                    (click)="deleteAdditionalDetails(i)"
                  ></svg-icon>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="ai-form-container" *ngIf="this.isCreateAI">
  <div class="ai-create-form-container">
    <div class="ai-prompt-container">
      <h3 class="ai-form-prompt-heading" translate>formCreateAISelectPlant</h3>
      <div class="ai-chat-container">
        <form [formGroup]="promptFormData" class="prompt-form">
          <label for="prompt" translate> selectPlant </label>
          <mat-form-field appearance="outline" class="width-100">
            <mat-select
              formControlName="plantId"
              [placeholder]="'plant' | translate"
              (openedChange)="resetPlantSearchFilter()"
              [disabled]="this.formData.formExists"
            >
              <input
                id="plantName"
                class="searchable-input"
                [placeholder]="'search' | translate"
                (keyup)="onKeyPlant($event)"
                [value]="plantFilterInput"
              />
              <div class="scrollable-area">
                <mat-option
                  id="plantOptions"
                  [value]="{
                    id: plant.id,
                    name: plant.plantId + ' - ' + plant.name
                  }"
                  *ngFor="let plant of plantInformation"
                  >{{ plant.plantId }} - {{ plant.name }}</mat-option
                >
              </div>
            </mat-select>
            <mat-error
              id="plantError"
              *ngIf="processValidationErrors('plantId')"
              class="m-t-5 error-fields"
            >
              {{
                errors.plantId.name
                  | translate
                    : {
                        name: 'plant' | translate
                      }
              }}
            </mat-error>
          </mat-form-field>
        </form>
      </div>
    </div>
    <div class="ai-prompt-container">
      <h3 class="ai-form-prompt-heading" translate>formCreateAIHeading</h3>
      <div class="ai-chat-container">
        <form [formGroup]="promptFormData" class="prompt-form">
          <label for="prompt" translate> enterPrompt </label>
          <div class="prompt-container">
            <div class="prompt-container-icon">
              <svg-icon icon="icon-add-form-ai" class="icon"></svg-icon>
            </div>
            <div class="prompt-container-input">
              <mat-form-field appearance="outline">
                <textarea
                  [disabled]="this.promptFormData.get('plantId').invalid"
                  class="prompt-input"
                  id="prompt"
                  matInput
                  matAutosize
                  name="prompt"
                  placeholder="Type your prompt here"
                  formControlName="prompt"
                  cdkTextareaAutosize
                  #autosize="cdkTextareaAutosize"
                  cdkAutosizeMinRows="1"
                  cdkAutosizeMaxRows="25"
                ></textarea>
              </mat-form-field>
            </div>
            <div class="prompt-container-icon">
              <button class="prompt-submit-btn" (click)="onPromptSubmit()">
                <svg-icon icon="icon-send-form-ai" class="icon"></svg-icon>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <div
      *ngIf="formCreateLoading$ | async"
      class="prompt-form-loader-container"
    >
      <img src="assets/Images/ai-form-loader.gif" alt="" class="loader-icon" />
      <span class="prompt-form-loader">
        {{ 'formGenerationLoader' | translate }}</span
      >
    </div>
    <ng-container *ngIf="isPromptGenerated$ | async">
      <span class="prompt-form-result-text">
        {{
          'formGenerationText'
            | translate : { plant: this.promptFormData.value.plantId.name }
        }}</span
      >
      <form [formGroup]="generatedPromptForm" class="width-100">
        <div formArrayName="generatedForms" class="width-100">
          <div *ngFor="let form of generatedForms.controls; let i = index">
            <div [formGroupName]="i">
              <div class="prompt-generated-form-container">
                <div class="prompt-generated-form-title-container">
                  <img
                    src="assets/rdf-forms-icons/formlogo.svg"
                    class="prompt-generated-form-title-icon"
                    alt=""
                  />
                  <a
                    matTooltip="{{ form.get('formTitle').value }}"
                    class="dis-inline"
                  >
                    <a class="width-90">
                      <input
                        id="formNameText"
                        #name
                        type="text"
                        [size]="name.value !== '' ? getSize(name.value) : 20"
                        class="form_title_input"
                        formControlName="formTitle"
                        autofocus="true"
                        autocomplete="off"
                        (keyup.enter)="form.get('formTitle').disable()"
                        (blur)="form.get('formTitle').disable()"
                      />

                      <!-- <mat-error
                      id="formNameError"
                      *ngIf="processValidationErrors('formTitle')"
                      class="error-fields"
                    >
                      {{
                        errors.name.name
                          | translate
                            : {
                                name: 'name' | translate,
                                length: errors.name.length
                              }
                      }}
                    </mat-error> -->
                    </a>
                    <button
                      id="formNameEditBtn"
                      (click)="editFormName()"
                      class="edit-icon"
                      *ngIf="form.get('formTitle').disabled === true"
                    >
                      <svg-icon
                        id="formNameEditIcon"
                        icon="icon-edit-icon"
                        class="edit-icon-img"
                      ></svg-icon>
                    </button>
                  </a>
                </div>
                <p class="prompt-generated-form-section-heading" translate>
                  sections
                </p>
                <div class="prompt-generated-form-section-container">
                  <div class="prompt-regenerate-form-section">
                    <button
                      class="prompt-regenerate-section-btn"
                      (click)="onSectionRegenerate(i)"
                      [disabled]="disableRegenerateIdx.includes(i.toString())"
                    >
                      <div
                        [ngClass]="[
                          disableRegenerateIdx.includes(i.toString())
                            ? 'disabled'
                            : ''
                        ]"
                      >
                        <svg-icon
                          icon="icon-regenerate-section-ai"
                          class="icon"
                        ></svg-icon>
                      </div>
                    </button>
                  </div>
                  <mat-form-field
                    class="width-100 margin-top--6"
                    appearance="outline"
                  >
                    <quill-material
                      [ngClass]="{
                        'display-toolbar': isOpen.value
                      }"
                      formControlName="sections"
                      [placeholder]="'addNotes' | translate"
                      class="prompt-generated-section-field"
                      (editorFocus)="handleEditorFocus($event)"
                    >
                    </quill-material>

                    <mat-error
                      id="notesAndAttachementsError"
                      *ngIf="maxLengthWithoutBulletPoints(250)"
                      class="m-5 error-fields"
                    >
                      {{ 'errorExceedingLimit' | translate }}
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
      <div class="prompt-regenerate-container">
        <p class="prompt-regenerate-title" translate>regenerateForms</p>
        <div class="prompt-regenerate-btn" (click)="onPromptSubmit()" translate>
          <svg-icon icon="icon-regenerate-section-ai" class="icon"></svg-icon>
          regenerateResponse
        </div>
      </div>
    </ng-container>
  </div>
</div>
