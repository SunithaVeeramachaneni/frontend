<div mat-dialog-actions align="end" class="buttons">
  <button
    id="cancelBtn"
    mat-stroked-button
    type="button"
    color="primary"
    class="skip-btn"
    (click)="onCancel()"
    translate="cancelBtn"
  ></button>
  <button
    id="nextBtn"
    mat-raised-button
    type="submit"
    color="primary"
    class="next-btn"
    (click)="next()"
    [disabled]="headerDataForm.invalid || tagsCtrl.invalid"
    translate="nextBtn"
  ></button>
</div>

<div class="form-header-modal" [formGroup]="headerDataForm">
  <div class="dis-flex form-content">
    <div class="width-5"></div>
    <div class="width-95">
      <div class="form-detials">
        <h2 class="heading" id="formDetails">
          {{ 'setFormDetailsHeading' | translate }}
        </h2>

        <div class="form-name">
          <p class="form-name-description" id="formType">
            {{ 'formType' | translate }}
          </p>
          <p class="formtype-formfield">
            {{
              (this.headerDataForm.get('formType').value === 'Embedded'
                ? 'createEmbedded'
                : 'createStandalone'
              ) | translate
            }}
          </p>

          <p class="form-name-description" id="formNameHeading">
            {{ 'addFormNameMandatory' | translate }}
          </p>
          <mat-form-field appearance="outline" class="width-100">
            <input
              id="formName"
              type="text"
              name="formName"
              matInput
              [placeholder]="'formName' | translate"
              formControlName="name"
            />
            <mat-error
              *ngIf="processValidationErrors('name')"
              class="m-5 error-fields"
              id="formNameError"
            >
              {{
                errors.name.name
                  | translate
                    : { name: 'name' | translate, length: errors.name.length }
              }}
            </mat-error>
          </mat-form-field>
          <p
            id="formDescriptionHeading"
            class="form-name-description"
            translate="addFormDescription"
          ></p>
          <mat-form-field appearance="outline" class="width-100">
            <input
              id="formDescription"
              type="text"
              matInput
              name="formDescription"
              [placeholder]="'addDescription' | translate"
              formControlName="description"
            />
          </mat-form-field>
          <p class="form-name-description" id="plantHeading">
            {{ 'plantMandatory' | translate }}
          </p>
          <mat-form-field appearance="outline" class="width-100">
            <mat-select
              formControlName="plantId"
              [placeholder]="'plant' | translate"
              (openedChange)="resetPlantSearchFilter()"
              [disabled]="this.formData.formExists"
            >
              <input
                id="plantName"
                class="searchable-input"
                [placeholder]="'search' | translate"
                (keyup)="onKeyPlant($event)"
                [value]="plantFilterInput"
              />
              <div class="scrollable-area">
                <mat-option
                  id="plantOptions"
                  [value]="plant.id"
                  *ngFor="let plant of plantInformation"
                  >{{ plant.plantId }} - {{ plant.name }}</mat-option
                >
              </div>
            </mat-select>
            <mat-error
              id="plantError"
              *ngIf="processValidationErrors('plantId')"
              class="m-t-5 error-fields"
            >
              {{
                errors.plantId.name
                  | translate
                    : {
                        name: 'plant' | translate
                      }
              }}
            </mat-error>
          </mat-form-field>
        </div>
        <div class="tags">
          <p id="tagsHeading" class="form-name-description m-b-0">
            {{ 'tags' | translate }}
          </p>
          <mat-form-field class="chips-list width-100" appearance="outline">
            <mat-chip-list #chipList>
              <mat-chip
                *ngFor="let tag of tags"
                [selectable]="selectable"
                [removable]="removable"
                (removed)="remove(tag)"
                class="tags-mat-chips"
              >
                {{ tag }}
                <mat-icon matChipRemove *ngIf="removable" id="cancelTag"
                  >cancel</mat-icon
                >
              </mat-chip>
              <input
                id="AddTag"
                [placeholder]="'startTypingTags' | translate"
                [matChipInputFor]="chipList"
                [matAutocomplete]="auto"
                [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                (matChipInputTokenEnd)="add($event)"
                (click)="openAutoComplete()"
                #tagsInput
                [formControl]="tagsCtrl"
              />
            </mat-chip-list>

            <mat-autocomplete
              #auto="matAutocomplete"
              (optionSelected)="selected($event)"
            >
              <mat-option
                *ngFor="let tag of filteredTags | async"
                [value]="tag"
                id="tagOptions"
              >
                {{ tag }}
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>
          <mat-error
            id="tagsError"
            *ngIf="processValidationErrorTags()"
            class="m-5"
          >
            {{
              errors.tagsCtrl.name
                | translate
                  : {
                      name: 'tags' | translate,
                      length: errors.tagsCtrl.length
                    }
            }}
          </mat-error>
        </div>

        <div
          class="notes-attachment"
          formGroupName="instructions"
          *ngIf="
            headerDataForm.get('formType').value ===
            formConfigurationStatus.standalone
          "
        >
          <p
            id="notesAndAttachementsHeading"
            class="form-name-description m-b-0 m-t-20"
            translate="notesAndAttachment"
          ></p>
          <mat-form-field
            class="notes-attachment width-100"
            appearance="outline"
          >
            <quill-material
              #notes
              [ngClass]="{
                'display-toolbar': isOpen.value
              }"
              formControlName="notes"
              [placeholder]="'addNotes' | translate"
              class="notes-field"
              (editorFocus)="handleEditorFocus($event)"
            >
            </quill-material>

            <mat-error
              id="notesAndAttachementsError"
              *ngIf="maxLengthWithoutBulletPoints(250)"
              class="m-5 error-fields"
            >
              {{ 'errorExceedingLimit' | translate }}
            </mat-error>
          </mat-form-field>
        </div>

        <div
          class="add-attachments"
          *ngIf="
            headerDataForm.get('formType').value ===
            formConfigurationStatus.standalone
          "
        >
          <br />
          <input
            id="addAttachments"
            type="file"
            class="file-upload"
            accept="image/jpeg,image/jpg,image/png,application/pdf"
            (change)="formFileUploadHandler($event)"
            [hidden]="true"
            #formFileUpload
          />

          <button
            id="attachmentsBtn"
            mat-button
            color="primary"
            class="upload-button"
            (click)="formFileUpload.click()"
          >
            <mat-icon class="icon-upload" id="attachmentsIcon">link</mat-icon>
            <span id="attachmentsText" translate="addImagesAndPDFBtnNew"></span>
          </button>

          <div class="attachments-container">
            <span
              id="attachmentsTrack"
              *ngFor="
                let image of filteredMediaType.mediaType;
                index as i;
                trackBy: trackBySelectedattachments
              "
              class="m-r-10"
            >
              <app-upload-image-preview
                [image]="image"
                (imageIndexEmitter)="formFileDeleteHandler(i)"
                class="attachments cursor-pointer"
                (triggerPreviewDialog)="openPreviewDialog()"
              ></app-upload-image-preview>
            </span>

            <span
              *ngFor="
                let pdf of pdfFiles.mediaType;
                index as i;
                trackBy: trackBySelectedattachments
              "
              class="m-r-10"
            >
              <app-instruction-pdf
                [pdf]="pdf"
                (indexEmitter)="formPdfDeleteHandler(i)"
              ></app-instruction-pdf>
            </span>
          </div>
        </div>

        <div class="additional-details">
          <p
            translate="additionalDetailsHeading"
            id="additionalDetailsHeading"
            class="additional-details-text"
          ></p>
        </div>
        <div class="m-t-15" *ngIf="isLoading$ | async">
          <div class="ghost-loading">
            <div *ngFor="let number of ghostLoading">
              <ngx-shimmer-loading [width]="'100%'" [height]="'40px'">
              </ngx-shimmer-loading>
            </div>
          </div>
        </div>
        <div *ngIf="(isLoading$ | async) === false">
          <div
            class="label-value-text"
            *ngIf="
              headerDataForm.get('additionalDetails')['controls']?.length > 0
            "
          >
            <div class="width-45 label" id="labelHeading">
              {{ 'label' | translate }}
            </div>
            <div class="width-45 m-l-20 value" id="valueHeading">
              {{ 'value' | translate }}
            </div>
          </div>
          <div formArrayName="additionalDetails">
            <div
              *ngFor="
                let additionalDetails of getAdditionalDetailList();
                let i = index
              "
            >
              <div [formGroupName]="i" class="dis-flex">
                <div class="width-45">
                  <p class="formtype-formfield">
                    {{ additionalDetails.value.label }}
                  </p>
                </div>

                <div class="width-45">
                  <mat-form-field
                    appearance="outline"
                    class="m-l-20 symbol m-b-10 width-100 value-field"
                  >
                    <mat-label id="filterStatusLabel">Select</mat-label>
                    <mat-select
                      #matSelect
                      multiple
                      [(value)]="additionalDetails.value.selectedValue"
                      name="showStatus"
                      placeholder="Select"
                      (closed)="
                        matSelectClosed(
                          i,
                          additionalDetails.value.label,
                          searchInput
                        )
                      "
                      [compareWith]="compareValues"
                      (selectionChange)="
                        onSelectionChange(
                          $event,
                          additionalDetails.value.label,
                          i
                        )
                      "
                    >
                      <div class="scroll-headers">
                        <div class="multiple-header">
                          <span id="doneLabel">Select</span>
                          <button
                            id="filterDoneBtn"
                            class="done-filters-btn"
                            (click)="closeSelect(matSelect)"
                          >
                            {{ 'done' | translate }}
                          </button>
                        </div>
                        <div class="custom-form-field-gray-color">
                          <mat-form-field
                            appearance="outline"
                            class="search-form-field"
                          >
                            <mat-icon
                              id="ValueSearchIcon"
                              matPrefix
                              class="searchIcon"
                              >search</mat-icon
                            >
                            <input
                              id="valueSearchText"
                              #searchInput
                              matInput
                              type="text"
                              [placeholder]="
                                'additionalDetailsSearch' | translate
                              "
                              autocomplete="off"
                              (keyup)="
                                valueSearch(
                                  $event,
                                  additionalDetails.value.label,
                                  i
                                )
                              "
                              (keydown)="$event.stopPropagation()"
                            />
                          </mat-form-field>
                        </div>
                      </div>
                      <mat-select-trigger>
                        {{
                          additionalDetails?.value.value.length > 0 &&
                          additionalDetailMap[additionalDetails.value?.label]
                            .length !==
                            additionalDetails['value']['value'].length
                            ? additionalDetails.value.selectedValue[0]
                            : ''
                        }}
                        <span
                          *ngIf="
                            additionalDetailMap[additionalDetails.value.label]
                              .length > 1 &&
                            additionalDetailMap[additionalDetails.value.label]
                              .length !==
                              additionalDetails['value']['value'].length
                          "
                        >
                          (+{{
                            additionalDetailMap[additionalDetails.value.label]
                              .length - 1
                          }}
                          {{
                            additionalDetailMap[additionalDetails.value.label]
                              .length === 2
                              ? 'other'
                              : 'others'
                          }})
                        </span>
                        <span
                          *ngIf="
                            additionalDetailMap[additionalDetails.value.label]
                              .length ===
                            additionalDetails['value']['value']?.length
                          "
                          >All
                        </span>
                      </mat-select-trigger>
                      <div class="scrollable-area">
                        <mat-option
                          *ngFor="let addValue of additionalDetails.value.value"
                          [value]="addValue"
                        >
                          {{ addValue }}
                        </mat-option>
                      </div>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
