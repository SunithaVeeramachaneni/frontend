<div class="list-view" *ngIf="userInfo$ | async">
  <div class="main-container">
    <div class="forms-header">
      <h2 id="formsListHeading" class="heading" translate="myForms"></h2>
      <div class="custom-form-field-gray-color search">
        <span class="no-of-forms" *ngIf="formsListCount$ | async as totalCount">
          <span id="formsListCount" class="forms-count">
            {{ totalCount }} &nbsp;
          </span>
          <span id="formsListCountNum" class="forms-text">{{
            'forms'
              | translate
                : {
                    count: totalCount || 0
                  }
          }}</span>
        </span>
        <mat-form-field appearance="outline">
          <mat-icon matPrefix id="formsListsearchIcon" class="searchIcon"
            >search</mat-icon
          >
          <input
            id="searchFormsList"
            matInput
            type="text"
            [placeholder]="'searchForms' | translate"
            autocomplete="off"
            [formControl]="searchForm"
          />

          <svg-icon
            icon="icon-filterIcon"
            cdkOverlayOrigin
            class="pointer"
            #trigger="cdkOverlayOrigin"
            (click)="isPopoverOpen = !isPopoverOpen"
            id="formListfilterBtn"
            matSuffix
            class="filter-icon"
          ></svg-icon>
        </mat-form-field>
        <button
          id="formsListCreateNewBtn"
          *appCheckUserHasPermission="[perms.createForm, perms.importForm]"
          [matMenuTriggerFor]="menu"
          class="create-new-btn"
          translate="createNew"
        ></button>
        <mat-menu
          id="createFormMEnu"
          #menu="matMenu"
          backdropClass="template-list"
        >
          <button
            id="uploadExcelMenu"
            mat-menu-item
            [matMenuTriggerFor]="uploadMenu"
          >
            <svg-icon
              id="uploadExcelIcon"
              icon="icon-excel1"
              class="add-manually-icon"
            ></svg-icon>
            <span
              id="uploadExcelSpan"
              class="create-template"
              translate="uploadExcel"
            >
            </span>
          </button>

          <button
            mat-menu-item
            id="createManuallyButton"
            [matMenuTriggerFor]="createMenu"
          >
            <svg-icon
              id="addManuallyIcon"
              icon="icon-add-manually"
              class="add-manually-icon"
            ></svg-icon>
            {{ 'createManually' | translate }}
          </button>
        </mat-menu>

        <mat-menu #uploadMenu="matMenu" id="formTypeUploadMenu">
          <button
            id="embeddedUploaderButton"
            mat-menu-item
            (click)="embeddedUploader.click()"
          >
            <span id="uploadEmbeddedSpan" translate="uploadEmbedded"></span>
          </button>
          <button
            id="standaloneUploaderButton"
            mat-menu-item
            (click)="standaloneUploader.click()"
          >
            <span id="uploadStandaloneSpan" translate="uploadStandalone"></span>
          </button>
        </mat-menu>

        <mat-menu #createMenu="matMenu" id="formTypeCreateMenu">
          <button
            id="embeddedCreateButton"
            mat-menu-item
            (click)="openFormCreationModal(null, 'Embedded')"
          >
            <span id="createEmbeddedSpan" translate="createEmbedded"></span>
          </button>
          <button
            id="standaloneCreateButton"
            mat-menu-item
            (click)="openFormCreationModal(null, 'Standalone')"
          >
            <span id="createStandaloneSpan" translate="createStandalone"></span>
          </button>
        </mat-menu>
        <button
          id="moreButton"
          mat-raised-button
          [matMenuTriggerFor]="moreMenu"
          class="more-btn"
          *appCheckUserHasPermission="[perms.importForm]"
        >
          <mat-icon id="moreMenuIcon" class="menu-icon">more_horiz</mat-icon>
        </button>
        <mat-menu id="moreMenu" #moreMenu="matMenu">
          <button
            id="templateMenuButton"
            mat-menu-item
            class="menu-buttons"
            [matMenuTriggerFor]="templateMenu"
          >
            <svg-icon
              id="excelIconMenu"
              icon="icon-excel1"
              class="menu-icons"
            ></svg-icon>
            <span id="downloadTemplateSpan" translate="downloadTemplate"></span>
          </button>
        </mat-menu>
        <mat-menu id="downloadTemplateMeny" #templateMenu="matMenu">
          <button
            id="downloadEmbeddedTemplateButton"
            mat-menu-item
            (click)="downloadTemplate('Embedded')"
          >
            <span id="downloadEmbeddedSpan" translate="uploadEmbedded"></span>
          </button>
          <button
            id="downloadStandloneTemplateButton"
            mat-menu-item
            (click)="downloadTemplate('Standalone')"
          >
            <span
              id="downloadStandaloneSpan"
              translate="uploadStandalone"
            ></span>
          </button>
        </mat-menu>
        <input
          id="standaloneUploader"
          hidden
          type="file"
          #standaloneUploader
          accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
          (change)="uploadFile($event, 'Standalone')"
          (click)="resetFile($event)"
        />
        <input
          id="embeddedUploader"
          hidden
          type="file"
          #embeddedUploader
          accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
          (change)="uploadFile($event, 'Embedded')"
          (click)="resetFile($event)"
        />
      </div>
    </div>

    <div *ngIf="(forms$ | async) && (isLoading$ | async) === false">
      <cwp-dynamictable
        [dataSource]="dataSource"
        [configOptions]="configOptions"
        (fetchDataCallback)="handleTableEvent($event)"
        (rowLevelActionHandler)="rowLevelActionHandler($event)"
        (onConfigOptionsChange)="configOptionsChangeHandler($event)"
        (cellClickActionHandler)="cellClickActionHandler($event)"
        class="width-100"
      ></cwp-dynamictable>
    </div>
  </div>

  <ng-container *ngIf="menuState">
    <app-form-detail
      [@slideInOut]="menuState"
      (slideInOut)="onCloseViewDetail()"
      [selectedForm]="selectedForm"
      (formDetailAction)="formDetailActionHandler()"
    ></app-form-detail>
  </ng-container>

  <div *ngIf="isLoading$ | async">
    <div class="ghost-loading">
      <div *ngFor="let number of ghostLoading">
        <ngx-shimmer-loading [width]="'100%'" [height]="'40px'">
        </ngx-shimmer-loading>
      </div>
    </div>
  </div>

  <ng-template
    cdkConnectedOverlay
    cdkConnectedOverlayPanelClass="custom-popover"
    cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
    [cdkConnectedOverlayHasBackdrop]="true"
    [cdkConnectedOverlayOpen]="isPopoverOpen"
    [cdkConnectedOverlayOrigin]="trigger"
    cdkConnectedOverlayWidth="400px"
    (backdropClick)="isPopoverOpen = false"
  >
    <app-filter
      [json]="filterJson"
      (close)="isPopoverOpen = false"
      (apply)="applyFilter($event)"
      (reset)="resetFilter()"
    ></app-filter>
  </ng-template>
</div>
