<div
  *ngIf="permissions$ | async as permissions; else loadingPermissionList"
  class="m-t-5 permission-container"
>
  <mat-accordion *ngFor="let module of permissions; let i = index">
    <mat-expansion-panel
      (opened)="panelOpenState[i] = true"
      (closed)="panelOpenState[i] = false"
      hideToggle
      class="permissions-expand"
      [(expanded)]="panelOpenState[i]"
    >
      <mat-expansion-panel-header class="h-40 expansion-header">
        <mat-panel-title>
          <mat-checkbox
            [disabled]="isEditable"
            [checked]="module.checked"
            color="primary"
            [indeterminate]="fewComplete(module)"
            (change)="setAllChecked($event.checked, module)"
          >
            {{ module.name }}
          </mat-checkbox>
          <span class="permission-count">
            {{ module.countOfChecked }} of {{module.permissions.length}}
          </span>
          <mat-icon *ngIf="!panelOpenState[i]"> arrow_right </mat-icon>
          <mat-icon *ngIf="panelOpenState[i]">arrow_drop_down</mat-icon>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ul class="m-0">
        <li *ngFor="let permission of module.permissions">
          <mat-checkbox
            color="primary"
            [checked]="permission.checked"
            (change)="updateAllChecked($event.checked, permission)"
          >
            {{ permission.displayName }}
          </mat-checkbox>
        </li>
      </ul>
    </mat-expansion-panel>
  </mat-accordion>
</div>
<ng-template #loadingPermissionList>
  <div class="p-10">
    <ngx-shimmer-loading [width]="'40%'" [height]="'30px'">
    </ngx-shimmer-loading>
    <br />
    <ngx-shimmer-loading [width]="'40%'" [height]="'30px'">
    </ngx-shimmer-loading>
    <br />
    <ngx-shimmer-loading [width]="'40%'" [height]="'30px'">
    </ngx-shimmer-loading>
    <br />
    <ngx-shimmer-loading [width]="'40%'" [height]="'30px'">
    </ngx-shimmer-loading>
  </div>
</ng-template>
