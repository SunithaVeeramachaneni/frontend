<div
  *ngIf="permissions$ | async as permissions; else loadingPermissionList"
  [ngClass]="{
    'permissions-list': rolesWithPermissionsInUsers === userRolePermissions,
    'permissions-container': rolesWithPermissionsInUsers !== userRolePermissions
  }"
>
  <mat-accordion
    *ngFor="let module of permissions; let i = index"
    class="dis-flex"
    multi
  >
    <mat-checkbox
      [checked]="module.checked"
      [indeterminate]="fewComplete(module)"
      (change)="setAllChecked($event.checked, module)"
      [disabled]="rolesWithPermissionsInUsers === userRolePermissions || isEditable === false"
      [ngClass]="{
        'p-t-5': rolesWithPermissionsInUsers === userRolePermissions,
        'permissions-checkbox':
          rolesWithPermissionsInUsers !== userRolePermissions
      }"
    >
    </mat-checkbox>
    <mat-expansion-panel
      (opened)="panelOpenState[i] = true"
      (closed)="panelOpenState[i] = false"
      hideToggle
      class="permissions-expand"
      [(expanded)]="panelOpenState[i]"
    >
      <mat-expansion-panel-header class="h-40 expansion-header">
        <mat-panel-title>
          <div class="my-panel" (click)="$event.stopPropagation()">
            <span class="module-name">{{ module.name }}</span>
            <span class="permission-count">
              {{ module.countOfChecked }} of {{ module.permissions.length }}
            </span>
          </div>
          <mat-icon *ngIf="!panelOpenState[i]"> arrow_right </mat-icon>
          <mat-icon *ngIf="panelOpenState[i]">arrow_drop_down</mat-icon>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <ul class="m-0 p-0">
        <li *ngFor="let permission of module.permissions">
          <mat-checkbox
            [checked]="permission.checked"
            (change)="updateAllChecked($event.checked, permission)"
            [disabled]="rolesWithPermissionsInUsers === userRolePermissions || isEditable === false"
          >
            {{ permission.displayName }}
          </mat-checkbox>
        </li>
      </ul>
    </mat-expansion-panel>
  </mat-accordion>
</div>
<ng-template #loadingPermissionList>
  <div class="p-10">
    <ngx-shimmer-loading [width]="'40%'" [height]="'30px'">
    </ngx-shimmer-loading>
    <br />
    <ngx-shimmer-loading [width]="'40%'" [height]="'30px'">
    </ngx-shimmer-loading>
    <br />
    <ngx-shimmer-loading [width]="'40%'" [height]="'30px'">
    </ngx-shimmer-loading>
    <br />
    <ngx-shimmer-loading [width]="'40%'" [height]="'30px'">
    </ngx-shimmer-loading>
  </div>
</ng-template>
