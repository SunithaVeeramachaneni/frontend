<div class="main-container" *ngIf="loggedInUserInfo$ | async">
  <div class="users-header">
    <span class="custom-form-field-gray-color search">
      <mat-form-field appearance="outline">
        <mat-icon matPrefix class="searchIcon">search</mat-icon>
        <input
          matInput
          type="text"
          [placeholder]="'searchUsers' | translate"
          autocomplete="off"
          [formControl]="searchUser"
        />
      </mat-form-field>
    </span>

    <button
      mat-raised-button
      class="add-user-btn"
      [matMenuTriggerFor]="addUserMenu"
      translate="addUserBtn"
    ></button>

    <mat-menu menu #addUserMenu="matMenu">
      <button mat-menu-item class="text-black" (click)="uploader.click()">
        <img
          src="assets/user-management-icons/upload-from-excel.svg"
          alt="Excel"
          class="menu-icons"
        />
        <span translate="Upload Excel"></span>
      </button>
      <button
        mat-menu-item
        (click)="openEditAddUserModal()"
        *appCheckUserHasPermission="[perms.createUser]"
        class="text-black"
      >
        <span translate="addManually"></span>
      </button>
    </mat-menu>

    <input
      id="upload"
      hidden
      type="file"
      #uploader
      accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,audio/*,video/*"
      (change)="uploadFile($event)"
      (click)="resetFile($event)"
    />

    <span class="no-of-users" *ngIf="userCount$ | async as userCount">
      <span class="users-count" *ngIf="userCount.count">
        {{ userCount.count }}
      </span>
      <span class="users-count" *ngIf="!userCount.count">0</span>
      <span class="users-text">{{
        'usersPlural'
          | translate
            : {
                count: userCount.count ? userCount.count : 0
              }
      }}</span>
    </span>
    <button
      mat-icon-button
      [matMenuTriggerFor]="menu"
      class="more-users"
      *appCheckUserHasPermission="[perms.deactivateUser]"
      aria-label="More Options"
    >
      <mat-icon>more_horiz</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <button
        mat-menu-item
        [disabled]="selectedUsers.length > 1 || disableDeactivate"
        (click)="deactivateUsers()"
        class="text-red"
      >
        <span translate="deactivate"></span>
      </button>
      <button (click)="downloadTemplate()" mat-menu-item class="menu-buttons">
        <img
          src="assets/user-management-icons/upload-from-excel.svg"
          alt="Excel"
          class="menu-icons"
        />
        <span translate="downloadTemplate"></span>
      </button>
    </mat-menu>
  </div>
  <div
    *ngIf="users$ | async as users; else loadingUsers"
    class="dis-flex users-content"
  >
    <cwp-dynamictable
      [dataSource]="dataSource"
      [configOptions]="configOptions"
      (fetchDataCallback)="handleTableEvent($event)"
      (rowLevelActionHandler)="rowLevelActionHandler($event)"
      (onConfigOptionsChange)="configOptionsChangeHandler($event)"
      (cellClickActionHandler)="cellClickActionHandler($event)"
      class="width-100"
    ></cwp-dynamictable>
  </div>
</div>

<ng-template #loadingUsers>
  <div style="padding: 0 20px">
    <ngx-shimmer-loading [width]="'100%'" [height]="'40px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
    <ngx-shimmer-loading [width]="'100%'" [height]="'20px'">
    </ngx-shimmer-loading>
  </div>
</ng-template>
